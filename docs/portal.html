<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MED Rezeption - Zugang</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 50%, #1e293b 100%);
            position: relative;
            overflow: hidden;
        }
        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 50%, rgba(8,145,178,0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 50%, rgba(34,211,238,0.06) 0%, transparent 50%);
            animation: portalBg 20s ease infinite;
        }
        @keyframes portalBg {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(-2%, -1%); }
        }
        .portal-container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 420px;
            padding: 0 1rem;
        }
        .portal-card {
            background: rgba(255,255,255,0.97);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3), 0 0 0 1px rgba(255,255,255,0.1);
            overflow: hidden;
        }
        .portal-header {
            background: linear-gradient(135deg, #0891b2 0%, #0e7490 100%);
            padding: 2.5rem 2rem 2rem;
            text-align: center;
            color: #fff;
        }
        .portal-header .portal-icon {
            width: 72px;
            height: 72px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
            backdrop-filter: blur(4px);
            border: 2px solid rgba(255,255,255,0.2);
        }
        .portal-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }
        .portal-header p {
            font-size: 0.85rem;
            opacity: 0.85;
        }
        .portal-body {
            padding: 2rem 2rem 1.5rem;
            text-align: center;
        }
        .portal-body .portal-hinweis {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 1.75rem;
            line-height: 1.6;
        }
        .portal-eingabe-gruppe {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.25rem;
        }
        .portal-pin {
            width: 48px;
            height: 56px;
            text-align: center;
            font-size: 1.3rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            background: #f8fafc;
            border: 1.5px solid #e2e8f0;
            border-radius: 10px;
            color: #1e293b;
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .portal-pin:focus {
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(8,145,178,0.12);
        }
        .portal-pin.fehler {
            border-color: #dc2626;
            animation: shake 0.4s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-6px); }
            75% { transform: translateX(6px); }
        }
        .portal-pin.ok {
            border-color: #16a34a;
            color: #16a34a;
            background: #f0fdf4;
        }
        .portal-status {
            font-size: 0.85rem;
            font-weight: 600;
            height: 1.2rem;
            margin-bottom: 0.5rem;
            transition: color 0.3s;
        }
        .portal-status.fehler { color: #dc2626; }
        .portal-status.ok { color: #16a34a; }
        .portal-versuche {
            display: inline-block;
            background: #fef2f2;
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 0.3rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8rem;
        }
        .portal-versuche.hidden { display: none; }
        .portal-footer {
            text-align: center;
            padding: 0 2rem 1.75rem;
        }
        .portal-demo-info {
            background: #ecfeff;
            border: 1px solid #a5f3fc;
            border-radius: 10px;
            padding: 0.85rem 1rem;
            font-size: 0.8rem;
            color: #164e63;
            line-height: 1.5;
        }
        .portal-demo-info strong {
            display: block;
            margin-bottom: 0.3rem;
            font-size: 0.85rem;
        }
        .portal-demo-info code {
            background: rgba(6,182,212,0.12);
            padding: 0.1rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            font-weight: 600;
        }
        .portal-version {
            position: fixed;
            bottom: 1rem;
            right: 1.5rem;
            color: rgba(255,255,255,0.3);
            font-size: 0.75rem;
            z-index: 1;
        }
        .gesperrt .portal-pin { pointer-events: none; opacity: 0.3; }
        @media (max-width: 480px) {
            .portal-header { padding: 1.75rem 1.25rem 1.5rem; }
            .portal-body { padding: 1.5rem 1.25rem 1.25rem; }
            .portal-footer { padding: 0 1.25rem 1.25rem; }
            .portal-pin { width: 42px; height: 50px; font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <div class="portal-container">
        <div class="portal-card" id="portal">
            <div class="portal-header">
                <div class="portal-icon"><i class="fa-solid fa-shield-halved"></i></div>
                <h1>Geschuetzter Bereich</h1>
                <p>Zutrittscode eingeben</p>
            </div>
            <div class="portal-body">
                <p class="portal-hinweis">
                    Zugang nur fuer autorisiertes Personal.<br>
                    Unbefugte Zugriffe werden protokolliert.
                </p>
                <div class="portal-eingabe-gruppe" id="pin-gruppe">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="0">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="1">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="2">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="3">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="4">
                    <input type="password" class="portal-pin" maxlength="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" data-pos="5">
                </div>
                <div class="portal-status" id="portal-status"></div>
                <div class="portal-versuche hidden" id="portal-versuche"></div>
            </div>
            <div class="portal-footer">
                <div class="portal-demo-info">
                    <strong><i class="fa-solid fa-info-circle"></i> Demo-Zutrittscode</strong>
                    PIN: <code>483926</code>
                </div>
            </div>
        </div>
    </div>
    <div class="guard-easter" style="position:fixed;bottom:3rem;left:0;right:0;text-align:center;color:#ffffff;font-size:0.9rem;font-style:normal;text-transform:uppercase;font-weight:700;opacity:1;z-index:1;letter-spacing:0.15em;">niemand hat die absicht einen ai agent zu entwickeln</div>
    <div class="portal-version">MED Rezeption v1.0 MVP</div>

    <script>
    (function() {
        // --- Zutrittscode (6-stellig) ---
        // Aendern Sie diesen Code fuer Ihre Installation:
        var ZUTRITTS_CODE = "483926";

        // Bereits freigeschaltet?
        if (sessionStorage.getItem("med_portal_ok")) {
            window.location.href = "guard.html";
            return;
        }

        var felder = document.querySelectorAll(".portal-pin");
        var statusEl = document.getElementById("portal-status");
        var versucheEl = document.getElementById("portal-versuche");
        var portalEl = document.getElementById("portal");
        var versuche = 0;
        var maxVersuche = 5;
        var gesperrt = false;

        // Sperre pruefen
        try {
            var sperreData = localStorage.getItem("med_portal_sperre");
            if (sperreData) {
                var sperre = JSON.parse(sperreData);
                var verbleibend = sperre.bis - Date.now();
                if (verbleibend > 0) {
                    sperreAktivieren(Math.ceil(verbleibend / 1000));
                } else {
                    localStorage.removeItem("med_portal_sperre");
                }
            }
        } catch (e) {}

        // Fokus auf erstes Feld
        felder[0].focus();

        // Eingabe-Logik
        for (var i = 0; i < felder.length; i++) {
            felder[i].addEventListener("input", function() {
                if (gesperrt) return;
                var pos = parseInt(this.getAttribute("data-pos"));
                // Nur Ziffern
                this.value = this.value.replace(/[^0-9]/g, "");
                if (this.value && pos < felder.length - 1) {
                    felder[pos + 1].focus();
                }
                // Alle Felder gefuellt?
                if (pos === felder.length - 1 && this.value) {
                    pruefenCode();
                }
            });

            felder[i].addEventListener("keydown", function(e) {
                if (gesperrt) return;
                var pos = parseInt(this.getAttribute("data-pos"));
                // Backspace -> vorheriges Feld
                if (e.key === "Backspace" && !this.value && pos > 0) {
                    felder[pos - 1].focus();
                    felder[pos - 1].value = "";
                }
                // Enter -> pruefen
                if (e.key === "Enter") pruefenCode();
            });

            // Paste-Support
            felder[i].addEventListener("paste", function(e) {
                if (gesperrt) return;
                e.preventDefault();
                var text = (e.clipboardData || window.clipboardData).getData("text").replace(/[^0-9]/g, "");
                for (var j = 0; j < felder.length && j < text.length; j++) {
                    felder[j].value = text[j];
                }
                if (text.length >= felder.length) pruefenCode();
                else if (text.length > 0) felder[Math.min(text.length, felder.length - 1)].focus();
            });
        }

        function pruefenCode() {
            var eingabe = "";
            for (var j = 0; j < felder.length; j++) eingabe += felder[j].value;

            if (eingabe.length < felder.length) return;

            if (eingabe === ZUTRITTS_CODE) {
                // Richtig
                for (var k = 0; k < felder.length; k++) felder[k].classList.add("ok");
                statusEl.textContent = "Zugang gewaehrt";
                statusEl.className = "portal-status ok";
                sessionStorage.setItem("med_portal_ok", "1");
                localStorage.removeItem("med_portal_sperre");
                setTimeout(function() { window.location.href = "guard.html"; }, 600);
            } else {
                // Falsch
                versuche++;
                for (var m = 0; m < felder.length; m++) {
                    felder[m].classList.add("fehler");
                    felder[m].value = "";
                }
                statusEl.textContent = "Zugang verweigert";
                statusEl.className = "portal-status fehler";

                var rest = maxVersuche - versuche;
                if (rest > 0) {
                    versucheEl.textContent = rest + " Versuch" + (rest > 1 ? "e" : "") + " verbleibend";
                    versucheEl.className = "portal-versuche";
                } else {
                    // Sperre: 5 Minuten
                    var sperrZeit = 300;
                    localStorage.setItem("med_portal_sperre", JSON.stringify({ bis: Date.now() + sperrZeit * 1000 }));
                    sperreAktivieren(sperrZeit);
                    return;
                }

                setTimeout(function() {
                    for (var n = 0; n < felder.length; n++) felder[n].classList.remove("fehler");
                    statusEl.textContent = "";
                    felder[0].focus();
                }, 1200);
            }
        }

        function sperreAktivieren(sekunden) {
            gesperrt = true;
            portalEl.classList.add("gesperrt");
            versucheEl.className = "portal-versuche";

            function countdown() {
                if (sekunden <= 0) {
                    gesperrt = false;
                    versuche = 0;
                    portalEl.classList.remove("gesperrt");
                    statusEl.textContent = "";
                    versucheEl.className = "portal-versuche hidden";
                    localStorage.removeItem("med_portal_sperre");
                    felder[0].focus();
                    return;
                }
                var min = Math.floor(sekunden / 60);
                var sek = sekunden % 60;
                statusEl.textContent = "Zugang gesperrt";
                statusEl.className = "portal-status fehler";
                versucheEl.textContent = "Wartezeit: " + min + ":" + (sek < 10 ? "0" : "") + sek;
                sekunden--;
                setTimeout(countdown, 1000);
            }
            countdown();
        }
    })();
    </script>
</body>
</html>
