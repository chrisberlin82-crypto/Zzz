<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500" viewBox="0 0 800 500">
  <defs>
    <marker id="arrow-vb" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#64748b"/>
    </marker>
    <marker id="arrow-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#22c55e"/>
    </marker>
    <marker id="arrow-purple" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#7c3aed"/>
    </marker>
    <filter id="shadow-vb" x="-2%" y="-2%" width="104%" height="104%">
      <feDropShadow dx="1" dy="1" stdDeviation="1.5" flood-opacity="0.12"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="800" height="500" fill="#f8fafc"/>

  <!-- Title -->
  <text x="400" y="28" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="18" font-weight="700" fill="#1e293b">Asterisk Voicebot (AGI)</text>
  <line x1="230" y1="37" x2="570" y2="37" stroke="#cbd5e1" stroke-width="1"/>

  <!-- ==================== -->
  <!-- START: Anruf eingehend (green rounded) -->
  <!-- ==================== -->
  <rect x="30" y="50" width="140" height="40" rx="20" fill="#22c55e" filter="url(#shadow-vb)"/>
  <!-- Phone icon (simple) -->
  <rect x="48" y="63" width="12" height="16" rx="3" fill="none" stroke="#ffffff" stroke-width="1.5"/>
  <line x1="51" y1="75" x2="57" y2="75" stroke="#ffffff" stroke-width="1"/>
  <text x="68" y="74" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#ffffff">Anruf eingehend</text>

  <!-- Arrow: Start -> Willkommen -->
  <line x1="170" y1="70" x2="200" y2="70" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- ==================== -->
  <!-- Willkommen dialog (blue) -->
  <!-- ==================== -->
  <rect x="210" y="50" width="145" height="40" rx="8" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="282" y="74" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="600" fill="#ffffff">Willkommen</text>
  <text x="282" y="59" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="8" fill="#93c5fd">agi_playback</text>

  <!-- Arrow: Willkommen -> DTMF Branch -->
  <line x1="355" y1="70" x2="390" y2="70" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- ==================== -->
  <!-- DTMF Branch (orange diamond) -->
  <!-- ==================== -->
  <polygon points="430,45 470,70 430,95 390,70" fill="#f59e0b" stroke="#d97706" stroke-width="1" filter="url(#shadow-vb)"/>
  <text x="430" y="68" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="9" font-weight="700" fill="#ffffff">DTMF</text>
  <text x="430" y="78" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="8" font-weight="600" fill="#ffffff">Eingabe</text>

  <!-- ==================== -->
  <!-- Branch 1: DTMF 1 -> Terminvergabe (going down-left) -->
  <!-- ==================== -->
  <line x1="430" y1="95" x2="430" y2="115" stroke="#64748b" stroke-width="1.5"/>
  <text x="445" y="108" font-family="Segoe UI, Arial, sans-serif" font-size="9" font-weight="600" fill="#d97706">1</text>

  <!-- Terminvergabe label -->
  <rect x="365" y="118" width="130" height="28" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="430" y="136" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#ffffff">Terminvergabe</text>

  <!-- Arrow down from Terminvergabe -->
  <line x1="430" y1="146" x2="430" y2="164" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Fachrichtung waehlen -->
  <rect x="345" y="170" width="170" height="28" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="430" y="188" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#ffffff">Fachrichtung waehlen</text>

  <!-- Arrow down -->
  <line x1="430" y1="198" x2="430" y2="216" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Arzt suchen -->
  <rect x="355" y="222" width="150" height="28" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="430" y="240" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#ffffff">Arzt suchen</text>

  <!-- Arrow down -->
  <line x1="430" y1="250" x2="430" y2="268" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Termin vorschlagen -->
  <rect x="345" y="274" width="170" height="28" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="430" y="292" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#ffffff">Termin vorschlagen</text>

  <!-- Arrow down -->
  <line x1="430" y1="302" x2="430" y2="320" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Bestaetigung -->
  <rect x="365" y="326" width="130" height="28" rx="6" fill="#22c55e" filter="url(#shadow-vb)"/>
  <text x="430" y="344" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#ffffff">Bestaetigung</text>

  <!-- Arrow down -->
  <line x1="430" y1="354" x2="430" y2="372" stroke="#7c3aed" stroke-width="1.5" marker-end="url(#arrow-purple)"/>

  <!-- API: Termin erstellen -->
  <rect x="345" y="378" width="170" height="32" rx="6" fill="#7c3aed" filter="url(#shadow-vb)"/>
  <text x="430" y="392" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#c4b5fd">API POST</text>
  <text x="430" y="404" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#ffffff">Termin erstellen</text>

  <!-- ==================== -->
  <!-- Branch 2: DTMF 2 -> Rezeptbestellung (going right) -->
  <!-- ==================== -->
  <line x1="470" y1="70" x2="530" y2="70" stroke="#64748b" stroke-width="1.5"/>
  <text x="498" y="64" font-family="Segoe UI, Arial, sans-serif" font-size="9" font-weight="600" fill="#d97706">2</text>

  <!-- Rezeptbestellung -->
  <rect x="540" y="50" width="150" height="28" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="615" y="68" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#ffffff">Rezeptbestellung</text>

  <!-- Arrow down -->
  <line x1="615" y1="78" x2="615" y2="104" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Versicherungsnummer -->
  <rect x="530" y="110" width="170" height="32" rx="6" fill="#2563eb" filter="url(#shadow-vb)"/>
  <text x="615" y="125" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#93c5fd">agi_get_data</text>
  <text x="615" y="137" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#ffffff">Versicherungsnr. eingeben</text>

  <!-- Arrow down -->
  <line x1="615" y1="142" x2="615" y2="160" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Bestaetigung Rezept -->
  <rect x="555" y="166" width="120" height="28" rx="6" fill="#22c55e" filter="url(#shadow-vb)"/>
  <text x="615" y="184" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#ffffff">Bestaetigung</text>

  <!-- Arrow down -->
  <line x1="615" y1="194" x2="615" y2="212" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- Transfer -->
  <rect x="550" y="218" width="130" height="28" rx="6" fill="#ef4444" filter="url(#shadow-vb)"/>
  <text x="615" y="236" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#ffffff">Transfer Apotheke</text>

  <!-- ==================== -->
  <!-- Branch 3: DTMF 3/0 -> Transfer Rezeption (going right-down) -->
  <!-- ==================== -->
  <line x1="470" y1="70" x2="530" y2="70" stroke="#64748b" stroke-width="1.5"/>
  <path d="M460,82 Q460,95 480,95 L530,95" fill="none" stroke="#64748b" stroke-width="1.5"/>
  <text x="498" y="92" font-family="Segoe UI, Arial, sans-serif" font-size="9" font-weight="600" fill="#d97706">3/0</text>

  <!-- Transfer Rezeption -->
  <rect x="540" y="270" width="150" height="32" rx="6" fill="#ef4444" filter="url(#shadow-vb)"/>
  <text x="615" y="285" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#fecaca">Direkt</text>
  <text x="615" y="297" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="600" fill="#ffffff">Transfer Rezeption</text>

  <!-- Arrow from branch 3/0 to Transfer Rezeption -->
  <path d="M540,95 L615,95 L615,270" fill="none" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-vb)"/>

  <!-- ==================== -->
  <!-- AGI Functions Panel (right side) -->
  <!-- ==================== -->
  <rect x="640" y="325" width="150" height="165" rx="8" fill="#ffffff" stroke="#e2e8f0" stroke-width="1.5" filter="url(#shadow-vb)"/>
  <rect x="640" y="325" width="150" height="24" rx="8" fill="#1e293b"/>
  <rect x="640" y="340" width="150" height="9" fill="#1e293b"/>
  <text x="715" y="342" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="700" fill="#ffffff">AGI Funktionen</text>

  <text x="655" y="370" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_playback</text>
  <text x="655" y="388" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_get_data</text>
  <text x="655" y="406" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_record</text>
  <text x="655" y="424" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_set_variable</text>
  <text x="655" y="442" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_exec</text>
  <text x="655" y="460" font-family="Consolas, monospace" font-size="10" fill="#1e293b">agi_hangup</text>

  <!-- Dotted line connecting AGI panel to flow -->
  <line x1="640" y1="390" x2="520" y2="290" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4,3"/>
  <line x1="640" y1="370" x2="520" y2="182" stroke="#94a3b8" stroke-width="1" stroke-dasharray="4,3"/>

  <!-- ==================== -->
  <!-- MED Backend API Box (bottom right) -->
  <!-- ==================== -->
  <rect x="640" y="440" width="150" height="50" rx="8" fill="#7c3aed" filter="url(#shadow-vb)"/>
  <text x="715" y="462" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="10" fill="#c4b5fd">REST API</text>
  <text x="715" y="478" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="700" fill="#ffffff">MED Backend</text>

  <!-- Arrow: Termin erstellen -> MED Backend -->
  <path d="M515,395 L580,395 Q590,395 590,410 L590,460 Q590,465 600,465 L640,465" fill="none" stroke="#7c3aed" stroke-width="1.8" marker-end="url(#arrow-purple)"/>
  <rect x="548" y="418" width="75" height="14" rx="3" fill="#f8fafc" stroke="#c4b5fd" stroke-width="0.5"/>
  <text x="585" y="428" text-anchor="middle" font-family="Segoe UI, Arial, sans-serif" font-size="8" fill="#7c3aed">HTTP POST</text>

  <!-- ==================== -->
  <!-- Legend (bottom left) -->
  <!-- ==================== -->
  <rect x="15" y="425" width="310" height="65" rx="6" fill="#ffffff" stroke="#e2e8f0" stroke-width="1"/>
  <text x="25" y="442" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="600" fill="#475569">Legende</text>

  <!-- Legend items row 1 -->
  <rect x="25" y="449" width="14" height="10" rx="3" fill="#22c55e"/>
  <text x="43" y="458" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#475569">Start / Bestaetigung</text>

  <rect x="140" y="449" width="14" height="10" rx="3" fill="#2563eb"/>
  <text x="158" y="458" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#475569">Dialog-Schritt</text>

  <rect x="230" y="449" width="14" height="10" rx="3" fill="#ef4444"/>
  <text x="248" y="458" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#475569">Transfer</text>

  <!-- Legend items row 2 -->
  <polygon points="32,470 39,475 32,480 25,475" fill="#f59e0b"/>
  <text x="43" y="479" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#475569">DTMF Verzweigung</text>

  <rect x="140" y="470" width="14" height="10" rx="3" fill="#7c3aed"/>
  <text x="158" y="479" font-family="Segoe UI, Arial, sans-serif" font-size="9" fill="#475569">API Aufruf</text>
</svg>